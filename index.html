<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Evrak Oluştur</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.5/pizzip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.41.1/docxtemplater.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>Tespit Tutanağı Oluştur</h2>

  <label>Adı Soyadı</label>
  <input type="text" id="surucu_adi">

  <label>T.C. Kimlik No</label>
  <input type="text" id="surucu_tc">

  <label>Telefon No</label>
  <input type="text" id="surucu_tel">

  <label>Doğum Yeri / Tarihi</label>
  <input type="text" id="surucu_dogum">

  <label>Araç Plakası</label>
  <input type="text" id="plaka">

  <label>Kooperatif Bilgileri</label>
  <input type="text" id="kooperatif">

  <label>Hat Numarası / Güzergah Adı</label>
  <input type="text" id="hat_no">

  <label>Araç Sahibi Açık Adresi</label>
  <textarea id="sahip_adres"></textarea>

  <hr>
  <label><input type="checkbox" id="rutin"> Rutin Denetim</label>
  <label><input type="checkbox" id="sozlu"> Sözlü/ Telefon Şikayeti</label>
  <label><input type="checkbox" id="cagri"> Çağrı Merkezi</label>

  <label>İş Emri İd:</label>
  <input type="text" id="is_emri_id">

  <label>İnfo Sayı:</label>
  <input type="text" id="info_sayi">

  <label>CİMER Sayı:</label>
  <input type="text" id="cimer_sayi">

  <label>Dilekçe Tarih-Sayı:</label>
  <input type="text" id="dilekce_tarih">

  <label>Şablon Word Dosyasını Yükleyin (.docx)</label>
  <input type="file" id="templateUpload" accept=".docx">

  <button onclick="generateDoc()">Belgeyi Oluştur</button>

  <script>
    function generateDoc() {
      const data = {
        surucu_adi: document.getElementById("surucu_adi").value,
        surucu_tc: document.getElementById("surucu_tc").value,
        surucu_tel: document.getElementById("surucu_tel").value,
        surucu_dogum: document.getElementById("surucu_dogum").value,
        plaka: document.getElementById("plaka").value,
        kooperatif: document.getElementById("kooperatif").value,
        hat_no: document.getElementById("hat_no").value,
        sahip_adres: document.getElementById("sahip_adres").value,
        rutin: document.getElementById("rutin").checked ? "✔" : "",
        sozlu: document.getElementById("sozlu").checked ? "✔" : "",
        cagri: document.getElementById("cagri").checked ? "✔" : "",
        is_emri_id: document.getElementById("is_emri_id").value,
        info_sayi: document.getElementById("info_sayi").value,
        cimer_sayi: document.getElementById("cimer_sayi").value,
        dilekce_tarih: document.getElementById("dilekce_tarih").value
      };

      const fileInput = document.getElementById("templateUpload");
      if (!fileInput.files[0]) return alert("Lütfen şablon dosyası yükleyin");

      const reader = new FileReader();
      reader.onload = function(evt) {
        const content = evt.target.result;
        const zip = new PizZip(content);
        const doc = new window.docxtemplater().loadZip(zip);

        doc.setData(data);

        try {
          doc.render();
        } catch (error) {
          console.error(error);
          alert("Şablon doldurulurken hata oluştu: " + error.message);
          return;
        }

        const out = doc.getZip().generate({ type: "blob" });
        saveAs(out, "tespit_tutanagi.docx");
      };
      reader.readAsBinaryString(fileInput.files[0]);
    }
  </script>
</body>
</html>
